{
  "name": "telco_churn_pipeline",
  "description": "End-to-end telco customer churn prediction pipeline: Bronze → Silver → Gold → Scoring → Monitoring",
  "schedule": {
    "quartz_cron_expression": "0 0 6 1 * ?",
    "timezone_id": "Europe/London",
    "pause_status": "UNPAUSED"
  },
  "tags": {
    "project": "telco-churn",
    "team": "data-science",
    "environment": "production"
  },
  "email_notifications": {
    "on_failure": ["data-team@uktelecomsltd.co.uk"],
    "on_success": []
  },
  "max_concurrent_runs": 1,
  "tasks": [
    {
      "task_key": "bronze_ingest",
      "description": "Ingest raw source files into Bronze Delta tables",
      "notebook_task": {
        "notebook_path": "/Repos/telco-churn/notebooks/01_bronze_ingestion",
        "source": "WORKSPACE"
      },
      "job_cluster_key": "etl_cluster",
      "timeout_seconds": 3600,
      "max_retries": 1,
      "retry_on_timeout": true
    },
    {
      "task_key": "silver_clean",
      "description": "Clean, type, and validate data in Silver layer",
      "depends_on": [
        {"task_key": "bronze_ingest"}
      ],
      "notebook_task": {
        "notebook_path": "/Repos/telco-churn/notebooks/02_silver_cleaning",
        "source": "WORKSPACE"
      },
      "job_cluster_key": "etl_cluster",
      "timeout_seconds": 7200,
      "max_retries": 1,
      "retry_on_timeout": true
    },
    {
      "task_key": "gold_features",
      "description": "Feature engineering + Feature Store registration",
      "depends_on": [
        {"task_key": "silver_clean"}
      ],
      "notebook_task": {
        "notebook_path": "/Repos/telco-churn/notebooks/03_gold_features",
        "source": "WORKSPACE"
      },
      "job_cluster_key": "etl_cluster",
      "timeout_seconds": 7200,
      "max_retries": 1,
      "retry_on_timeout": true
    },
    {
      "task_key": "batch_scoring",
      "description": "Score all active customers with multi-horizon Champion models",
      "depends_on": [
        {"task_key": "gold_features"}
      ],
      "notebook_task": {
        "notebook_path": "/Repos/telco-churn/notebooks/05_batch_scoring",
        "source": "WORKSPACE"
      },
      "job_cluster_key": "ml_cluster",
      "timeout_seconds": 3600,
      "max_retries": 1,
      "retry_on_timeout": true
    },
    {
      "task_key": "monitoring",
      "description": "Run monitoring checks and alert logic",
      "depends_on": [
        {"task_key": "batch_scoring"}
      ],
      "notebook_task": {
        "notebook_path": "/Repos/telco-churn/notebooks/06_monitoring",
        "source": "WORKSPACE"
      },
      "job_cluster_key": "ml_cluster",
      "timeout_seconds": 1800,
      "max_retries": 0
    },
    {
      "task_key": "model_retrain",
      "description": "Retrain models if monitoring flags drift (conditional logic inside notebook)",
      "depends_on": [
        {"task_key": "monitoring"}
      ],
      "notebook_task": {
        "notebook_path": "/Repos/telco-churn/notebooks/04_model_training",
        "source": "WORKSPACE"
      },
      "job_cluster_key": "ml_cluster",
      "timeout_seconds": 10800,
      "max_retries": 0
    }
  ],
  "job_clusters": [
    {
      "job_cluster_key": "etl_cluster",
      "new_cluster": {
        "spark_version": "14.3.x-scala2.12",
        "node_type_id": "Standard_D4s_v3",
        "num_workers": 4,
        "spark_conf": {
          "spark.sql.adaptive.enabled": "true",
          "spark.sql.adaptive.coalescePartitions.enabled": "true",
          "spark.sql.shuffle.partitions": "auto"
        },
        "custom_tags": {
          "project": "telco-churn",
          "layer": "etl"
        }
      }
    },
    {
      "job_cluster_key": "ml_cluster",
      "new_cluster": {
        "spark_version": "14.3.x-ml-scala2.12",
        "node_type_id": "Standard_D4s_v3",
        "num_workers": 2,
        "spark_conf": {
          "spark.sql.adaptive.enabled": "true"
        },
        "custom_tags": {
          "project": "telco-churn",
          "layer": "ml"
        }
      }
    }
  ]
}
